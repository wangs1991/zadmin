window.TPL=window.TPL||{},function(o){o.tplmap=o.tplmap||{},o.getTpl=o.getTpl||function(o){return this.tplmap[o]},o.tplmap["popimg.tpl"]='<div class="overlay" style="display: none;"></div><div class="pop-modal"><i class="pop-close iconfont icon-close_m"></i><i class="pop-detail iconfont icon-menu"></i><div class="modal_content"><ul class="pop-list"><!--存放详细信息--></ul><img src="http://fengyun-bar.b0.upaiyun.com/1470742916289691.jpg"></div></div>'}(TPL),window.popimg=function(){var o=null,t={},i={spacing:60,beforeShowDetail:function(){}},n={init:function(t){i=$.extend(i,t),o=n.getInstance(),n.initEvent()},initDom:function(){var o=TPL.getTpl("popimg.tpl");return $("body").append($(o)),{overlay:overlay,modal:modal}},initEvent:function(){$(window).on("resize",function(){n.computePosition()}),$("body").on("click",".preview-photo",function(o){var t=$(o.target).attr("href");return n.showImage(t),!1}),o.overlay.on("click",function(){n.hide()}),$(".pop-close",o.modal).on("click",function(){n.hide()}),$(".pop-detail",o.modal).on("click",function(){if($(".modal_content>.pop-list",o.modal).hasClass("pop-in"))return $(".modal_content>.pop-list",o.modal).removeClass("pop-in").delay(200).animate({top:"-100%"},200),!1;var n=i.beforeShowDetail()||t,a="";for(var e in n)a+="<li>"+e+" :"+n[e]+"</li>";$(".modal_content>.pop-list",o.modal).html(a).animate({top:0},400).addClass("pop-in")})},resetDom:function(){o.modal.removeClass("animate-out")},loadImg:function(){var o=$.Deferred(),i=new Image;return i.src=t.src,i.onload=function(){t.width=i.width,t.height=i.height,t.ratio=i.width/i.height,n.computePosition(),o.resolve()},i.error=function(){o.reject()},o},hide:function(){o.overlay.hide(500,function(){$("body").removeClass("pop-show")}),o.modal.addClass("animate-out").delay(300).removeClass("animate-in"),setTimeout(function(){n.resetDom()},500)},showImage:function(i){t.src=i,o.overlay.show(0,function(){$("body").addClass("pop-show")}),o.modal.show(0).addClass("animate-in"),n.loadImg(i).then(function(){$(".modal_content>img",o.modal).remove(),$(".modal_content",o.modal).append('<img src="'+t.src+'"/>'),console.log(t)},function(){alert("图片加载失败！")})},computePosition:function(){var n=$(window).width(),a=$(window).height(),e=Math.min(n-2*i.spacing,t.width),l=Math.min(a-2*i.spacing,t.height);setL=Math.max(i.spacing,(n-t.width)/2),setT=Math.max(i.spacing,(a-t.height)/2),e/l<t.ratio&&(l=e/t.ratio),e/l>t.ratio&&(e=l*t.ratio),o.modal.css({left:Math.abs(e-n)/2,top:Math.abs(l-a)/2,width:e,height:l})},getInstance:function(){return o?o:o=n.initDom()}};return{init:n.init,showImage:n.showImage,hide:n.hide}}();