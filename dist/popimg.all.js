$(function(){$("body").append($('<div id="popimg" class="popimg">\r\n    <div class="preview-photo" href="http://fengyun-bar.b0.upaiyun.com/1470742916289691.jpg" v-on:click="showImage($event)">ASDFA</div>\r\n\r\n\r\n    <div class="overlay" v-on:click="hide">\r\n\r\n    </div>\r\n    <div class="pop-modal">\r\n        <div class="pop-close iconfont icon-close_m" v-on:click="hide"></div>\r\n        <div class="pop-detail iconfont icon-menu" v-on:click="showInfo"></div>\r\n        <div class="modal_content">\r\n            <ul class="pop-list"></ul>\r\n        </div>\r\n    </div>\r\n</div>\r\n')),window.popimg=new Vue({el:"#popimg",data:{dominstance:null,imgData:{},config:{spacing:60,beforeShowDetail:function(){}}},methods:{init:function(t){this.config=$.extend(this.config,t),this.dominstance=this.getInstance(),this.initEvent()},showImage:function(t){var i=$(t.target).attr("href"),o=this;return this.imgData.src=i,this.dominstance.overlay.show(0,function(){$("body").addClass("pop-show")}),this.dominstance.modal.show(0).addClass("animate-in"),this.loadImg(i).then(function(){$(".modal_content>img",o.dominstance.modal).remove(),$(".modal_content",o.dominstance.modal).append('<img src="'+o.imgData.src+'"/>'),console.log(o.imgData)},function(){alert("图片加载失败！")}),!1},hide:function(){var t=this;this.dominstance.overlay.hide(500,function(){$("body").removeClass("pop-show")}),this.dominstance.modal.addClass("animate-out").delay(300).removeClass("animate-in"),setTimeout(function(){t.resetDom()},500)},getInstance:function(){return this.dominstance||(this.dominstance={overlay:$(".overlay"),modal:$(".pop-modal")}),console.log(this.dominstance),this.dominstance},initEvent:function(){var t=this;$(window).on("resize",function(){t.computePosition()})},showInfo:function(){if($(".modal_content>.pop-list",that.dominstance.modal).hasClass("pop-in"))return $(".modal_content>.pop-list",that.dominstance.modal).removeClass("pop-in").delay(200).animate({top:"-100%"},200),!1;var t=that.config.beforeShowDetail()||that.imgData,i="";for(var o in t)i+="<li>"+o+" :"+t[o]+"</li>";$(".modal_content>.pop-list",this.dominstance.modal).html(i).animate({top:0},400).addClass("pop-in")},computePosition:function(){var t=$(window).width(),i=$(window).height(),o=(this.config,this.imgData),n=Math.min(t-2*this.config.spacing,o.width),a=Math.min(i-2*this.config.spacing,o.height);n/a<o.ratio&&(a=n/o.ratio),n/a>o.ratio&&(n=a*o.ratio),this.dominstance.modal.css({left:Math.abs(n-t)/2,top:Math.abs(a-i)/2,width:n,height:a})},loadImg:function(){var t=$.Deferred(),i=new Image;return that=this,i.src=this.imgData.src,i.onload=function(){that.imgData.width=i.width,that.imgData.height=i.height,that.imgData.ratio=i.width/i.height,that.computePosition(),t.resolve()},i.error=function(){t.reject()},t},resetDom:function(){this.dominstance.modal.removeClass("animate-out")}},ready:function(){},computed:{modalLoc:function(){return console.log(this),{test:this.$options.methods.computePosition()}}}}),popimg.init()});